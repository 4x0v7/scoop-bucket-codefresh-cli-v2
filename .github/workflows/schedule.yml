on:
  schedule:
  - cron: '*/5 * * * *'
name: Excavator
jobs:
  excavate:
    name: Excavator
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@main
    - name: Excavator
      uses: shovel-org/GithubActions@main
      env:
        GITH_EMAIL: github-actions[scoop-autoupdate-bot]@users.noreply.github.com
        GITHUB_TOKEN: ${{ secrets.SCOOP_AUTOUPDATE_TOKEN }}
        SKIP_UPDATED: '1'
    # Checkout the repo again and check if new version was just commited
    # If Excavator just commited, it has no tag, dispatch to tagger
    - uses: actions/checkout@main
      with:
        ref: 'main'
    - name: Get tag
      id: tag
      uses: dawidd6/action-get-tag@v1
      continue-on-error: true
      with:
        strip_v: false
    - name: Repository Dispatch
      if: steps.tag.outcome != 'success' # https://stackoverflow.com/a/58003436
      uses: peter-evans/repository-dispatch@v1
      with:
        token: ${{ secrets.SCOOP_AUTOUPDATE_TOKEN }}
        event-type: schedule-run
        client-payload: '{"commit": "${{ github.sha }}"}'
